%% 
function [] = wt_in_gen(Rm,sites,Atom_num,Atom_name,SOCflag)
sites_num=sum(Atom_num);
fid = fopen('wt.in','w');
if SOCflag==1
    %% TITLE card
    dirname=pwd;
    dirname=strsplit(dirname,'/');
    fprintf(fid,"&TB_FILE \n");
    fprintf(fid, ...
    "Hrfile = 'wannier90_hr.dat'  \n"+ ...    
    "Package = 'VASP'             ! obtained from VASP, it could be 'VASP', 'QE', 'Wien2k', 'OpenMx'\n"+ ...
    "/\n");
    %% POSCAR_card 
    fprintf(fid,"LATTICE\nAngstrom\n");
    for i=1:3
        for j=1:3
           fprintf(fid,"%f ",Rm(i,j));
        end
        fprintf(fid,"\n");
    end
    fprintf(fid,"ATOM_POSITIONS\n");
    fprintf(fid,"%d\n",sites_num);
    fprintf(fid,"Direct\n");
    for i=1:sites_num
        fprintf(fid,"%s ",Atom_name(sites(i).nameseq));
        fprintf(fid,"%f  ",sites(i).rc1);
        fprintf(fid,"%f  ",sites(i).rc2);
        fprintf(fid,"%f  \n",sites(i).rc3);
    end
        
   %% Projectors_card
    fprintf(fid,"\n");
    phns='wt_in_projector_card'; %?????????????
    fpn=fopen(phns,'rt');%??????
    kline=-2;
    while feof(fpn) ~= 1 %????????p???????????????????????1?????0??
       file=fgetl(fpn);%????????
       new_str=file;
       fprintf(fid,'%s\n',new_str);%???????????txt?????
       kline=kline+1;
    end
    fprintf(fid,"\n");
    %% standcard
    fprintf(fid,...
    "SURFACE            ! Specify surface with two vectors, see doc \n"+...
    "1  0  0		! edge state : hkl (100) new a1= 100 a2 =001\n"+...  
    "0  1  0\n\n");
    fprintf(fid,...
    "!> bulk band structure calculation flag\n"+...
    "&CONTROL\n"+...
    "BulkBand_calc            = T\n"+...
    "!BulkBand_points_calc     = T\n"+...
    "!DOS_calc                 = T\n"+...
    "BulkFS_calc              = F\n"+...
    "BulkGap_cube_calc        = F\n"+...
    "BulkGap_plane_calc       = F\n"+...
    "!SlabBand_calc            = T\n"+...
    "!SlabBandWaveFunc_calc    = T\n"+...
    "!SlabBand_plane_calc      = T\n"+...
    "!WireBand_calc            = T\n"+...
    "!SlabSS_calc              = T\n"+...
    "!SlabArc_calc             = T\n"+...
    "!SlabQPI_calc             = T\n"+...
    "!ArcQPI_calc              = T\n"+...
    "!Z2_3D_calc               = T\n"+...
    "!SlabSpintexture_calc     = T\n"+...
    "!Wanniercenter_calc       = T\n"+...
    "/\n\n"+...
    "&SYSTEM\n"+...
    "NSLAB = 10              ! for thin film system\n"+...
    "NSLAB1= 4               ! nanowire system \n"+...
    "NSLAB2= 4               ! nanowire system \n"+...
    "NumOccupied = 10        ! NumOccupied    value-band\n"+...
    "SOC = 1                 ! soc\n"+...
    "E_FERMI = 0             ! e-fermi = 0 always\n"+...
    "surf_onsite= 0.0        ! surf_onsite\n"+...
    "/\n\n"+...
    "&PARAMETERS\n"+...
    "Eta_Arc = 0.0001     ! infinite small value, like brodening \n"+...
    "E_arc = 0.0         ! energy for calculate Fermi Arc\n"+...
    "OmegaNum = 800      ! omega number       \n"+...
    "OmegaMin = -0.4    ! energy interval\n"+...
    "OmegaMax =  0.2    ! energy interval\n"+...
    "Nk1 = 101           ! number k points  odd number would be better\n"+...
    "Nk2 = 101            ! number k points  odd number would be better\n"+...
    "Nk3 = 101            ! number k points  odd number would be better\n"+...
    "NP = 3              ! number of principle layers\n"+...
    "Gap_threshold = 0.01 ! threshold for FindNodes_calc output\n"+...
    "/\n");
 
    %% kpath card
      fprintf(fid,"\n");
    phns='wt_in_kpath_card'; %?????????????
    fpn=fopen(phns,'rt');%??????
    kline=-2;
    while feof(fpn) ~= 1 %????????p???????????????????????1?????0??
       file=fgetl(fpn);%????????
       new_str=file;
       fprintf(fid,'%s\n',new_str);%???????????txt?????
       kline=kline+1;
    end
    %% standard_card2 
    fprintf(fid,"\n");
    fprintf(fid,...      
    "KPATH_SLAB  ! minus dimension\n"+...
    "2        ! numker of k line for 2D case\n"+...
    "Z 0.0 0.5 G 0.0 0.0\n"+...
    "G 0.0 0.0 X 0.5 0.0\n\n"+...
    "KPLANE_SLAB\n"+...
    "-0.1    -0.1      ! Original point for 2D k plane\n"+...
    "0.2  0.0      ! The first vector to define 2D k plane\n"+...
    "0.0  0.2      ! The second vector to define 2D k plane  for arc plots\n");
% end ____________________________________________________________________________________________________________
else
    %% TITLE card
    sytemname="";
    for i=1:length(Atom_name)
        sytemname=sytemname+Atom_name(i)+num2str(Atom_num(i));
    end
    fprintf(fid,"&TB_FILE \n");
    fprintf(fid, ...
    "Hrfile = 'wannier90_hr.dat'  \n"+ ...    
    "Package = 'VASP'             ! obtained from VASP, it could be 'VASP', 'QE', 'Wien2k', 'OpenMx'\n"+ ...
    "/\n");
    %% POSCAR_card 
    fprintf(fid,"LATTICE\nAngstrom\n");
    for i=1:3
        for j=1:3
           fprintf(fid,"%f ",Rm(i,j));
        end
        fprintf(fid,"\n");
    end
    fprintf(fid,"ATOM_POSITIONS\n");
    fprintf(fid,"%d\n",sites_num);
    fprintf(fid,"Direct\n");
    for i=1:sites_num
        fprintf(fid,"%s ",Atom_name(sites(i).nameseq));
        fprintf(fid,"%f  ",sites(i).rc1);
        fprintf(fid,"%f  ",sites(i).rc2);
        fprintf(fid,"%f  \n",sites(i).rc3);
    end
        
   %% Projectors_card
    fprintf(fid,"\n");
    phns='wt_in_projector_card'; %?????????????
    fpn=fopen(phns,'rt');%??????
    kline=-2;
    while feof(fpn) ~= 1 %????????p???????????????????????1?????0??
       file=fgetl(fpn);%????????
       new_str=file;
       fprintf(fid,'%s\n',new_str);%???????????txt?????
       kline=kline+1;
    end
    fprintf(fid,"\n");
    %% standcard
    fprintf(fid,...
    "SURFACE            ! Specify surface with two vectors, see doc \n"+...
    "1  0  0		! edge state : hkl (100) new a1= 100 a2 =001\n"+...  
    "0  1  0\n\n");
    fprintf(fid,...
    "!> bulk band structure calculation flag\n"+...
    "&CONTROL\n"+...
    "BulkBand_calc            = T\n"+...
    "!BulkBand_points_calc     = T\n"+...
    "!DOS_calc                 = T\n"+...
    "BulkFS_calc              = F\n"+...
    "BulkGap_cube_calc        = F\n"+...
    "BulkGap_plane_calc       = F\n"+...
    "!SlabBand_calc            = T\n"+...
    "!SlabBandWaveFunc_calc    = T\n"+...
    "!SlabBand_plane_calc      = T\n"+...
    "!WireBand_calc            = T\n"+...
    "!SlabSS_calc              = T\n"+...
    "!SlabArc_calc             = T\n"+...
    "!SlabQPI_calc             = T\n"+...
    "!ArcQPI_calc              = T\n"+...
    "!Z2_3D_calc               = T\n"+...
    "!SlabSpintexture_calc     = T\n"+...
    "!Wanniercenter_calc       = T\n"+...
    "!Wanniercenter_calc       = T\n"+...
    "!FindNodes_calc           = T\n"+...
    "/\n\n"+...
    "&SYSTEM\n"+...
    "NSLAB = 10              ! for thin film system\n"+...
    "NSLAB1= 4               ! nanowire system \n"+...
    "NSLAB2= 4               ! nanowire system \n"+...
    "NumOccupied = 1        ! NumOccupied    value-band\n"+...
    "!SOC = 1                 ! soc\n"+...
    "E_FERMI = 0             ! e-fermi = 0 always\n"+...
    "surf_onsite= 0.0        ! surf_onsite\n"+...
    "/\n\n"+...
    "&PARAMETERS\n"+...
    "Eta_Arc = 0.0001     ! infinite small value, like brodening \n"+...
    "E_arc = 0.0         ! energy for calculate Fermi Arc\n"+...
    "OmegaNum = 1000      ! omega number       \n"+...
    "OmegaMin = -0.2    ! energy interval\n"+...
    "OmegaMax =  0.2    ! energy interval\n"+...
    "Nk1 = 301           ! number k points  odd number would be better\n"+...
    "Nk2 = 301            ! number k points  odd number would be better\n"+...
    "Nk3 = 301            ! number k points  odd number would be better\n"+...
    "NP = 3              ! number of principle layers\n"+...
    "Gap_threshold = 0.01 ! threshold for FindNodes_calc output\n"+...
    "/\n");
 
    %% kpath card
    fprintf(fid,"\n");
    phns='wt_in_kpath_card'; %?????????????
    fpn=fopen(phns,'rt');%??????
    kline=-2;
    while feof(fpn) ~= 1 %????????p???????????????????????1?????0??
       file=fgetl(fpn);%????????
       new_str=file;
       fprintf(fid,'%s\n',new_str);%???????????txt?????
       kline=kline+1;
    end
    %% standard_card2 
    fprintf(fid,"\n");
    fprintf(fid,...      
    "KPATH_SLAB  ! minus dimension\n"+...
    "2        ! numker of k line for 2D case\n"+...
    "Z 0.0 0.5 G 0.0 0.0\n"+...
    "G 0.0 0.0 X 0.5 0.0\n\n"+...
    "KPLANE_SLAB\n"+...
    "-0.1    -0.1      ! Original point for 2D k plane\n"+...
    "0.2  0.0      ! The first vector to define 2D k plane\n"+...
    "0.0  0.2      ! The second vector to define 2D k plane  for arc plots\n"+...
    "KCUBE_BULK\n"+...
    "-0.50 -0.50 -0.50   ! Original point for 3D k plane\n"+...
    "1.00  0.00  0.00   ! The 1st vector to define 3d k cube\n"+...
    "0.00  1.00  0.00   ! The 2nd vector to define 3d k cube\n"+...
    "0.00  0.00  1.00   ! The 3rd vector to define 3d k cube\n") ;
end


fclose(fid);

end
